package bank;

import java.math.BigDecimal;
import java.util.Scanner;

public final class Main {
    private static final Bank bank = new Bank();

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        while (true) {
            printMenu();
            String choice = sc.nextLine().trim();

            try {
                switch (choice) {
                    case "1" -> createChecking(sc);
                    case "2" -> createSavings(sc);
                    case "3" -> deposit(sc);
                    case "4" -> withdraw(sc);
                    case "5" -> transfer(sc);
                    case "6" -> showAccount(sc);
                    case "7" -> listAccounts();
                    case "0" -> { System.out.println("Bye."); return; }
                    default -> System.out.println("Invalid option.");
                }
            } catch (Exception e) {
                System.out.println("ERROR: " + e.getMessage());
            }
            System.out.println();
        }
    }

    private static void printMenu() {
        System.out.println("=== Simple Bank ===");
        System.out.println("1) Create Checking");
        System.out.println("2) Create Savings");
        System.out.println("3) Deposit");
        System.out.println("4) Withdraw");
        System.out.println("5) Transfer");
        System.out.println("6) Show Account");
        System.out.println("7) List Accounts");
        System.out.println("0) Exit");
        System.out.print("Select: ");
    }

    private static void createChecking(Scanner sc) {
        String owner = readNonEmpty(sc, "Owner name: ");
        BigDecimal opening = readMoney(sc, "Opening deposit: ");
        Account a = bank.createChecking(owner, opening);
        System.out.println("Created: " + a);
    }

    private static void createSavings(Scanner sc) {
        String owner = readNonEmpty(sc, "Owner name: ");
        BigDecimal opening = readMoney(sc, "Opening deposit: ");
        BigDecimal rate = readMoney(sc, "Annual interest rate (e.g. 0.03 for 3%): ");
        SavingsAccount a = bank.createSavings(owner, opening, rate);
        System.out.println("Created: " + a);
    }

    private static void deposit(Scanner sc) {
        String id = readNonEmpty(sc, "Account ID: ");
        BigDecimal amt = readMoney(sc, "Amount: ");
        bank.getAccount(id).deposit(amt, "Cash deposit");
        System.out.println("Deposited. New balance: $" + bank.getAccount(id).getBalance());
    }

    private static void withdraw(Scanner sc) {
        String id = readNonEmpty(sc, "Account ID: ");
        BigDecimal amt = readMoney(sc, "Amount: ");
        bank.getAccount(id).withdraw(amt, "Cash withdraw");
        System.out.println("Withdrew. New balance: $" + bank.getAccount(id).getBalance());
    }

    private static void transfer(Scanner sc) {
        String from = readNonEmpty(sc, "From Account ID: ");
        String to = readNonEmpty(sc, "To Account ID: ");
        BigDecimal amt = readMoney(sc, "Amount: ");

        Account a = bank.getAccount(from);
        Account b = bank.getAccount(to);
        a.transferTo(b, amt);

        System.out.println("Transferred.");
        System.out.println("From balance: $" + a.getBalance());
        System.out.println("To balance:   $" + b.getBalance());
    }

    private static void showAccount(Scanner sc) {
        String id = readNonEmpty(sc, "Account ID: ");
        Account a = bank.getAccount(id);
        System.out.println(a);
        System.out.println("--- Transactions ---");
        for (Transaction t : a.getHistory()) {
            System.out.println(t);
        }
    }

    private static void listAccounts() {
        System.out.println("--- Accounts ---");
        for (Account a : bank.getAllAccounts()) {
            System.out.println(a);
        }
    }

    private static String readNonEmpty(Scanner sc, String prompt) {
        while (true) {
            System.out.print(prompt);
            String s = sc.nextLine();
            if (s != null && !s.trim().isEmpty()) return s.trim();
            System.out.println("Input cannot be empty.");
        }
    }

    private static BigDecimal readMoney(Scanner sc, String prompt) {
        while (true) {
            System.out.print(prompt);
            String s = sc.nextLine().trim();
            try {
                return new BigDecimal(s);
            } catch (Exception e) {
                System.out.println("Enter a valid number (example: 25 or 25.50).");
            }
        }
    }
}
